# Google Gemini Structured Output

## Overview
Structured output generation allows Gemini to produce responses in specific, predictable formats rather than free-form text. This capability is essential for applications requiring consistent data structures, automated processing, and integration with other systems.

## Core Concepts

### Structured Output Types
1. **JSON Generation**: Create responses following JSON schemas
2. **Enum Values**: Limit responses to predefined options
3. **Typed Responses**: Generate responses with specific data types

### Key Benefits
- **Consistency**: Predictable response format every time
- **Integration**: Easy to parse and process programmatically
- **Validation**: Responses conform to defined schemas
- **Automation**: Enable automated downstream processing

## JSON Schema Configuration

### Recommended Approach
Configure the schema directly on the model for most reliable results:

```python
import google.generativeai as genai

# Define JSON schema
schema = {
    \"type\": \"object\",
    \"properties\": {
        \"name\": {
            \"type\": \"string\",
            \"description\": \"Person's full name\"
        },
        \"age\": {
            \"type\": \"integer\",
            \"description\": \"Person's age in years\"
        },
        \"skills\": {
            \"type\": \"array\",
            \"items\": {\"type\": \"string\"},
            \"description\": \"List of technical skills\"
        }
    },
    \"required\": [\"name\", \"age\"]
}

# Configure model with schema
model = genai.GenerativeModel(
    'gemini-2.5-flash',
    generation_config=genai.GenerationConfig(
        response_mime_type=\"application/json\",
        response_schema=schema
    )
)

# Generate structured response
response = model.generate_content(
    \"Extract information from this resume: John Smith, 30 years old, experienced in Python, JavaScript, and SQL.\"
)

print(response.text)  # Returns valid JSON
```

### Schema Definition Examples

#### Basic Person Schema
```python
person_schema = {
    \"type\": \"object\",
    \"properties\": {
        \"first_name\": {\"type\": \"string\"},
        \"last_name\": {\"type\": \"string\"},
        \"email\": {
            \"type\": \"string\",
            \"format\": \"email\"
        },
        \"phone\": {\"type\": \"string\"},
        \"address\": {
            \"type\": \"object\",
            \"properties\": {
                \"street\": {\"type\": \"string\"},
                \"city\": {\"type\": \"string\"},
                \"country\": {\"type\": \"string\"}
            }
        }
    },
    \"required\": [\"first_name\", \"last_name\"]
}\n```

#### Product Information Schema
```python
product_schema = {
    \"type\": \"object\",
    \"properties\": {
        \"product_name\": {\"type\": \"string\"},
        \"price\": {
            \"type\": \"number\",
            \"minimum\": 0
        },
        \"category\": {
            \"type\": \"string\",
            \"enum\": [\"electronics\", \"clothing\", \"books\", \"home\", \"other\"]
        },
        \"features\": {
            \"type\": \"array\",
            \"items\": {\"type\": \"string\"}
        },
        \"in_stock\": {\"type\": \"boolean\"},
        \"rating\": {
            \"type\": \"number\",\            \"minimum\": 1,\n            \"maximum\": 5\n        }\n    },\n    \"required\": [\"product_name\", \"price\", \"category\"]\n}\n```\n\n#### Complex Data Analysis Schema\n```python\nanalysis_schema = {\n    \"type\": \"object\",\n    \"properties\": {\n        \"summary\": {\"type\": \"string\"},\n        \"key_metrics\": {\n            \"type\": \"object\",\n            \"properties\": {\n                \"total_revenue\": {\"type\": \"number\"},\n                \"growth_rate\": {\"type\": \"number\"},\n                \"customer_count\": {\"type\": \"integer\"}\n            }\n        },\n        \"trends\": {\n            \"type\": \"array\",\n            \"items\": {\n                \"type\": \"object\",\n                \"properties\": {\n                    \"period\": {\"type\": \"string\"},\n                    \"value\": {\"type\": \"number\"},\n                    \"change\": {\"type\": \"number\"}\n                }\n            }\n        },\n        \"recommendations\": {\n            \"type\": \"array\",\n            \"items\": {\"type\": \"string\"}\n        }\n    },\n    \"required\": [\"summary\", \"key_metrics\"]\n}\n```\n\n## Enum-Based Responses\n\n### Simple Classification\n```python\n# Define enum schema\nsentiment_schema = {\n    \"type\": \"string\",\n    \"enum\": [\"positive\", \"negative\", \"neutral\"]\n}\n\nmodel = genai.GenerativeModel(\n    'gemini-2.5-flash',\n    generation_config=genai.GenerationConfig(\n        response_mime_type=\"text/plain\",\n        response_schema=sentiment_schema\n    )\n)\n\nresponse = model.generate_content(\n    \"Analyze the sentiment of this review: 'The product quality exceeded my expectations!'\"\n)\nprint(response.text)  # Returns: \"positive\"\n```\n\n### Complex Categorization\n```python\ncategory_schema = {\n    \"type\": \"object\",\n    \"properties\": {\n        \"primary_category\": {\n            \"type\": \"string\",\n            \"enum\": [\"technology\", \"business\", \"health\", \"education\", \"entertainment\"]\n        },\n        \"subcategory\": {\n            \"type\": \"string\",\n            \"enum\": [\"software\", \"hardware\", \"finance\", \"marketing\", \"medical\", \"fitness\"]\n        },\n        \"confidence\": {\n            \"type\": \"number\",\n            \"minimum\": 0,\n            \"maximum\": 1\n        }\n    },\n    \"required\": [\"primary_category\"]\n}\n```\n\n## Practical Use Cases\n\n### Resume Information Extraction\n```python\nresume_schema = {\n    \"type\": \"object\",\n    \"properties\": {\n        \"personal_info\": {\n            \"type\": \"object\",\n            \"properties\": {\n                \"name\": {\"type\": \"string\"},\n                \"email\": {\"type\": \"string\"},\n                \"phone\": {\"type\": \"string\"},\n                \"location\": {\"type\": \"string\"}\n            }\n        },\n        \"experience\": {\n            \"type\": \"array\",\n            \"items\": {\n                \"type\": \"object\",\n                \"properties\": {\n                    \"company\": {\"type\": \"string\"},\n                    \"position\": {\"type\": \"string\"},\n                    \"start_date\": {\"type\": \"string\"},\n                    \"end_date\": {\"type\": \"string\"},\n                    \"responsibilities\": {\n                        \"type\": \"array\",\n                        \"items\": {\"type\": \"string\"}\n                    }\n                }\n            }\n        },\n        \"skills\": {\n            \"type\": \"array\",\n            \"items\": {\"type\": \"string\"}\n        },\n        \"education\": {\n            \"type\": \"array\",\n            \"items\": {\n                \"type\": \"object\",\n                \"properties\": {\n                    \"institution\": {\"type\": \"string\"},\n                    \"degree\": {\"type\": \"string\"},\n                    \"field\": {\"type\": \"string\"},\n                    \"graduation_year\": {\"type\": \"integer\"}\n                }\n            }\n        }\n    },\n    \"required\": [\"personal_info\"]\n}\n\ndef extract_resume_info(resume_text: str):\n    model = genai.GenerativeModel(\n        'gemini-2.5-flash',\n        generation_config=genai.GenerationConfig(\n            response_mime_type=\"application/json\",\n            response_schema=resume_schema\n        )\n    )\n    \n    response = model.generate_content(\n        f\"Extract structured information from this resume:\\n\\n{resume_text}\"\n    )\n    \n    return json.loads(response.text)\n```\n\n### Invoice Processing\n```python\ninvoice_schema = {\n    \"type\": \"object\",\n    \"properties\": {\n        \"invoice_number\": {\"type\": \"string\"},\n        \"date\": {\"type\": \"string\"},\n        \"vendor\": {\n            \"type\": \"object\",\n            \"properties\": {\n                \"name\": {\"type\": \"string\"},\n                \"address\": {\"type\": \"string\"},\n                \"contact\": {\"type\": \"string\"}\n            }\n        },\n        \"customer\": {\n            \"type\": \"object\",\n            \"properties\": {\n                \"name\": {\"type\": \"string\"},\n                \"address\": {\"type\": \"string\"}\n            }\n        },\n        \"line_items\": {\n            \"type\": \"array\",\n            \"items\": {\n                \"type\": \"object\",\n                \"properties\": {\n                    \"description\": {\"type\": \"string\"},\n                    \"quantity\": {\"type\": \"number\"},\n                    \"unit_price\": {\"type\": \"number\"},\n                    \"total\": {\"type\": \"number\"}\n                }\n            }\n        },\n        \"subtotal\": {\"type\": \"number\"},\n        \"tax\": {\"type\": \"number\"},\n        \"total_amount\": {\"type\": \"number\"}\n    },\n    \"required\": [\"invoice_number\", \"date\", \"total_amount\"]\n}\n\ndef process_invoice(invoice_text: str):\n    model = genai.GenerativeModel(\n        'gemini-2.5-flash',\n        generation_config=genai.GenerationConfig(\n            response_mime_type=\"application/json\",\n            response_schema=invoice_schema\n        )\n    )\n    \n    response = model.generate_content(\n        f\"Extract all information from this invoice:\\n\\n{invoice_text}\"\n    )\n    \n    return json.loads(response.text)\n```\n\n### Survey Response Analysis\n```python\nsurvey_analysis_schema = {\n    \"type\": \"object\",\n    \"properties\": {\n        \"overall_sentiment\": {\n            \"type\": \"string\",\n            \"enum\": [\"very_positive\", \"positive\", \"neutral\", \"negative\", \"very_negative\"]\n        },\n        \"key_themes\": {\n            \"type\": \"array\",\n            \"items\": {\"type\": \"string\"}\n        },\n        \"sentiment_scores\": {\n            \"type\": \"object\",\n            \"properties\": {\n                \"product_quality\": {\"type\": \"number\", \"minimum\": 1, \"maximum\": 5},\n                \"customer_service\": {\"type\": \"number\", \"minimum\": 1, \"maximum\": 5},\n                \"value_for_money\": {\"type\": \"number\", \"minimum\": 1, \"maximum\": 5}\n            }\n        },\n        \"actionable_insights\": {\n            \"type\": \"array\",\n            \"items\": {\"type\": \"string\"}\n        },\n        \"response_classification\": {\n            \"type\": \"string\",\n            \"enum\": [\"promoter\", \"passive\", \"detractor\"]\n        }\n    },\n    \"required\": [\"overall_sentiment\", \"response_classification\"]\n}\n\ndef analyze_survey_response(response_text: str):\n    model = genai.GenerativeModel(\n        'gemini-2.5-flash',\n        generation_config=genai.GenerationConfig(\n            response_mime_type=\"application/json\",\n            response_schema=survey_analysis_schema\n        )\n    )\n    \n    response = model.generate_content(\n        f\"Analyze this customer survey response:\\n\\n{response_text}\"\n    )\n    \n    return json.loads(response.text)\n```\n\n## Integration Examples\n\n### Database Integration\n```python\nimport sqlite3\nimport json\n\nclass StructuredDataProcessor:\n    def __init__(self, db_path: str):\n        self.db_path = db_path\n        self.init_database()\n    \n    def init_database(self):\n        \"\"\"Initialize database tables.\"\"\"\n        conn = sqlite3.connect(self.db_path)\n        cursor = conn.cursor()\n        \n        cursor.execute(\"\"\"\n            CREATE TABLE IF NOT EXISTS products (\n                id INTEGER PRIMARY KEY,\n                name TEXT,\n                price REAL,\n                category TEXT,\n                in_stock BOOLEAN,\n                features TEXT\n            )\n        \"\"\")\n        \n        conn.commit()\n        conn.close()\n    \n    def process_product_description(self, description: str):\n        \"\"\"Extract product info and save to database.\"\"\"\n        # Generate structured output\n        model = genai.GenerativeModel(\n            'gemini-2.5-flash',\n            generation_config=genai.GenerationConfig(\n                response_mime_type=\"application/json\",\n                response_schema=product_schema\n            )\n        )\n        \n        response = model.generate_content(\n            f\"Extract product information from: {description}\"\n        )\n        \n        product_data = json.loads(response.text)\n        \n        # Save to database\n        conn = sqlite3.connect(self.db_path)\n        cursor = conn.cursor()\n        \n        cursor.execute(\"\"\"\n            INSERT INTO products (name, price, category, in_stock, features)\n            VALUES (?, ?, ?, ?, ?)\n        \"\"\", (\n            product_data['product_name'],\n            product_data['price'],\n            product_data['category'],\n            product_data.get('in_stock', True),\n            json.dumps(product_data.get('features', []))\n        ))\n        \n        conn.commit()\n        conn.close()\n        \n        return product_data\n```\n\n### API Response Generation\n```python\nfrom flask import Flask, request, jsonify\n\napp = Flask(__name__)\n\n@app.route('/analyze-feedback', methods=['POST'])\ndef analyze_feedback():\n    \"\"\"API endpoint for feedback analysis.\"\"\"\n    feedback_text = request.json.get('feedback', '')\n    \n    feedback_schema = {\n        \"type\": \"object\",\n        \"properties\": {\n            \"sentiment\": {\n                \"type\": \"string\",\n                \"enum\": [\"positive\", \"negative\", \"neutral\"]\n            },\n            \"urgency\": {\n                \"type\": \"string\",\n                \"enum\": [\"low\", \"medium\", \"high\", \"critical\"]\n            },\n            \"category\": {\n                \"type\": \"string\",\n                \"enum\": [\"bug_report\", \"feature_request\", \"complaint\", \"praise\", \"question\"]\n            },\n            \"summary\": {\"type\": \"string\"},\n            \"action_required\": {\"type\": \"boolean\"}\n        },\n        \"required\": [\"sentiment\", \"urgency\", \"category\"]\n    }\n    \n    model = genai.GenerativeModel(\n        'gemini-2.5-flash',\n        generation_config=genai.GenerationConfig(\n            response_mime_type=\"application/json\",\n            response_schema=feedback_schema\n        )\n    )\n    \n    response = model.generate_content(\n        f\"Analyze this customer feedback: {feedback_text}\"\n    )\n    \n    analysis = json.loads(response.text)\n    \n    return jsonify({\n        \"status\": \"success\",\n        \"analysis\": analysis\n    })\n```\n\n## Best Practices\n\n### Schema Design\n1. **Clear descriptions**: Include helpful descriptions for all fields\n2. **Appropriate types**: Use correct JSON Schema types\n3. **Required fields**: Mark essential fields as required\n4. **Validation rules**: Add constraints like minimum/maximum values\n5. **Enum values**: Use enums for limited option sets\n\n### Response Quality\n1. **Provide context**: Include relevant context in prompts\n2. **Use examples**: Show expected output format when helpful\n3. **Validate responses**: Check that responses conform to schema\n4. **Handle errors**: Plan for malformed or incomplete responses\n5. **Test thoroughly**: Validate with various input types\n\n### Performance Optimization\n1. **Schema size**: Keep schemas reasonably sized\n2. **Required fields**: Mark only truly required fields\n3. **Default values**: Use defaults where appropriate\n4. **Caching**: Cache schema-based models when possible\n5. **Batch processing**: Process multiple items efficiently\n\n## Error Handling\n\n### Common Issues\n1. **Schema violations**: Response doesn't match schema\n2. **Invalid JSON**: Malformed JSON output\n3. **Missing required fields**: Required fields not provided\n4. **Type mismatches**: Wrong data types in response\n\n### Robust Error Handling\n```python\nimport json\nfrom jsonschema import validate, ValidationError\n\ndef safe_structured_generation(prompt: str, schema: dict, max_retries: int = 3):\n    \"\"\"Generate structured output with error handling and retries.\"\"\"\n    model = genai.GenerativeModel(\n        'gemini-2.5-flash',\n        generation_config=genai.GenerationConfig(\n            response_mime_type=\"application/json\",\n            response_schema=schema\n        )\n    )\n    \n    for attempt in range(max_retries):\n        try:\n            response = model.generate_content(prompt)\n            \n            # Parse JSON\n            try:\n                data = json.loads(response.text)\n            except json.JSONDecodeError as e:\n                print(f\"JSON decode error on attempt {attempt + 1}: {e}\")\n                if attempt == max_retries - 1:\n                    return {\"error\": \"Failed to generate valid JSON\"}\n                continue\n            \n            # Validate against schema\n            try:\n                validate(instance=data, schema=schema)\n                return data\n            except ValidationError as e:\n                print(f\"Schema validation error on attempt {attempt + 1}: {e}\")\n                if attempt == max_retries - 1:\n                    return {\"error\": \"Response doesn't match schema\", \"data\": data}\n                continue\n                \n        except Exception as e:\n            print(f\"Generation error on attempt {attempt + 1}: {e}\")\n            if attempt == max_retries - 1:\n                return {\"error\": \"Failed to generate response\"}\n    \n    return {\"error\": \"Maximum retries exceeded\"}\n```\n\n## Advanced Techniques\n\n### Dynamic Schema Generation\n```python\ndef create_dynamic_schema(field_definitions: dict):\n    \"\"\"Create schema based on dynamic field definitions.\"\"\"\n    schema = {\n        \"type\": \"object\",\n        \"properties\": {},\n        \"required\": []\n    }\n    \n    for field_name, field_config in field_definitions.items():\n        schema[\"properties\"][field_name] = {\n            \"type\": field_config[\"type\"],\n            \"description\": field_config.get(\"description\", \"\")\n        }\n        \n        if field_config.get(\"enum\"):\n            schema[\"properties\"][field_name][\"enum\"] = field_config[\"enum\"]\n        \n        if field_config.get(\"required\", False):\n            schema[\"required\"].append(field_name)\n    \n    return schema\n\n# Usage\nfields = {\n    \"name\": {\"type\": \"string\", \"required\": True},\n    \"category\": {\"type\": \"string\", \"enum\": [\"A\", \"B\", \"C\"], \"required\": True},\n    \"score\": {\"type\": \"number\"}\n}\n\ndynamic_schema = create_dynamic_schema(fields)\n```\n\n### Conditional Schema Validation\n```python\ndef conditional_structured_generation(prompt: str, condition: str):\n    \"\"\"Generate different structures based on conditions.\"\"\"\n    if \"product\" in condition.lower():\n        schema = product_schema\n    elif \"person\" in condition.lower():\n        schema = person_schema\n    else:\n        schema = {\n            \"type\": \"object\",\n            \"properties\": {\n                \"content\": {\"type\": \"string\"},\n                \"type\": {\"type\": \"string\"}\n            }\n        }\n    \n    model = genai.GenerativeModel(\n        'gemini-2.5-flash',\n        generation_config=genai.GenerationConfig(\n            response_mime_type=\"application/json\",\n            response_schema=schema\n        )\n    )\n    \n    response = model.generate_content(prompt)\n    return json.loads(response.text)\n```\n\n## Performance Monitoring\n\n### Quality Metrics\n```python\nclass StructuredOutputMonitor:\n    def __init__(self):\n        self.successful_parses = 0\n        self.failed_parses = 0\n        self.schema_violations = 0\n        self.total_requests = 0\n    \n    def track_generation(self, prompt: str, schema: dict):\n        \"\"\"Track structured generation quality.\"\"\"\n        self.total_requests += 1\n        \n        try:\n            model = genai.GenerativeModel(\n                'gemini-2.5-flash',\n                generation_config=genai.GenerationConfig(\n                    response_mime_type=\"application/json\",\n                    response_schema=schema\n                )\n            )\n            \n            response = model.generate_content(prompt)\n            \n            # Try to parse\n            try:\n                data = json.loads(response.text)\n                \n                # Validate schema\n                try:\n                    validate(instance=data, schema=schema)\n                    self.successful_parses += 1\n                    return data\n                except ValidationError:\n                    self.schema_violations += 1\n                    return None\n                    \n            except json.JSONDecodeError:\n                self.failed_parses += 1\n                return None\n                \n        except Exception:\n            self.failed_parses += 1\n            return None\n    \n    def get_stats(self):\n        \"\"\"Get quality statistics.\"\"\"\n        if self.total_requests == 0:\n            return {}\n        \n        return {\n            \"success_rate\": self.successful_parses / self.total_requests,\n            \"parse_error_rate\": self.failed_parses / self.total_requests,\n            \"schema_violation_rate\": self.schema_violations / self.total_requests,\n            \"total_requests\": self.total_requests\n        }\n```\n\n## Limitations and Considerations\n\n### Schema Complexity\n- **Token limits**: Large schemas count toward input token limits\n- **Performance impact**: Complex schemas may affect generation speed\n- **Validation overhead**: Schema validation adds processing time\n- **Model limitations**: Very complex schemas may not be followed perfectly\n\n### Best Practice Recommendations\n1. **Start simple**: Begin with basic schemas and add complexity gradually\n2. **Test thoroughly**: Validate schemas with various inputs\n3. **Monitor quality**: Track success rates and common failures\n4. **Provide examples**: Include example outputs in prompts when helpful\n5. **Plan for failures**: Implement fallback strategies for invalid responses\n\n---\n\n**Last Updated:** Based on Google Gemini API documentation as of 2025\n**Reference:** https://ai.google.dev/gemini-api/docs/structured-output